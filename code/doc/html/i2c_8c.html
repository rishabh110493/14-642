<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>18-349 Kernel: i2c.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">18-349 Kernel
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_3dd30a497388ee684638f120a124721c.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">i2c.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>I2C implementation on rpi 2.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="kstdint_8h_source.html">kstdint.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="BCM2836_8h_source.html">BCM2836.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="gpio_8h_source.html">gpio.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="i2c_8h_source.html">i2c.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="printk_8h_source.html">printk.h</a>&gt;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adf9e8d5cc56f1499c36e8b21a2077c16"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#adf9e8d5cc56f1499c36e8b21a2077c16">i2c_master_init</a> (<a class="el" href="kstdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a> clk)</td></tr>
<tr class="memdesc:adf9e8d5cc56f1499c36e8b21a2077c16"><td class="mdescLeft">&#160;</td><td class="mdescRight">initializes the I2C module  <a href="#adf9e8d5cc56f1499c36e8b21a2077c16">More...</a><br/></td></tr>
<tr class="separator:adf9e8d5cc56f1499c36e8b21a2077c16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a133d4c889aaa1dbf4bede53f6a90f9d6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#a133d4c889aaa1dbf4bede53f6a90f9d6">i2c_master_write</a> (<a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *buf, <a class="el" href="kstdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a> len, <a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> addr)</td></tr>
<tr class="memdesc:a133d4c889aaa1dbf4bede53f6a90f9d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Algorithm: Clear off previously set flags, set the values of the DLEN and Address registers and set the start bit to 1. Wait for the transfer process to become active (TA). Once the transfer is active, check if the FIFO can accept data (TXD) and keep writing to the FIFO until the whole data has been written. If the FIFO gets filled, wait for it to be able to start accepting data again. If acknowledgement errors are encountered, the write process is terminated and 0 is returned.  <a href="#a133d4c889aaa1dbf4bede53f6a90f9d6">More...</a><br/></td></tr>
<tr class="separator:a133d4c889aaa1dbf4bede53f6a90f9d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dc23eedff49dd1a087a73a8b662c3dc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#a5dc23eedff49dd1a087a73a8b662c3dc">i2c_master_read</a> (<a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *buf, <a class="el" href="kstdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a> len, <a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> addr)</td></tr>
<tr class="memdesc:a5dc23eedff49dd1a087a73a8b662c3dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Algorithm: Clear off previously set flags, set the DLEN and Address registers, Set the start bit to 1 and wait for the data to get populated in the FIFO (RXD). Check for the errors in acknowledgement while waiting. If an acknowledgement error is encountered, the read process is terminated and the value returned is 0. Once the data is availablein the FIFO register (RXD), read it byte by byte and copy it to the location pointed by 'buf'.  <a href="#a5dc23eedff49dd1a087a73a8b662c3dc">More...</a><br/></td></tr>
<tr class="separator:a5dc23eedff49dd1a087a73a8b662c3dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>I2C implementation on rpi 2. </p>
<dl class="section date"><dt>Date</dt><dd>03 Oct 2016 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Rishabh Bhatnagar <a href="#" onclick="location.href='mai'+'lto:'+'ris'+'ha'+'bhb'+'@a'+'ndr'+'ew'+'.cm'+'u.'+'edu'; return false;">risha<span style="display: none;">.nosp@m.</span>bhb@<span style="display: none;">.nosp@m.</span>andre<span style="display: none;">.nosp@m.</span>w.cm<span style="display: none;">.nosp@m.</span>u.edu</a> </dd>
<dd>
Krishanu Ganguly <a href="#" onclick="location.href='mai'+'lto:'+'kri'+'sh'+'ang'+'@a'+'ndr'+'ew'+'.cm'+'u.'+'edu'; return false;">krish<span style="display: none;">.nosp@m.</span>ang@<span style="display: none;">.nosp@m.</span>andre<span style="display: none;">.nosp@m.</span>w.cm<span style="display: none;">.nosp@m.</span>u.edu</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="adf9e8d5cc56f1499c36e8b21a2077c16"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void i2c_master_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kstdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>&#160;</td>
          <td class="paramname"><em>clk</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initializes the I2C module </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">clk</td><td>bus clock speed in KHz </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="gpio_8h.html#a579a3153cf0e486a012d3e59a7945174">gpio_config()</a>, <a class="el" href="gpio_8h.html#a4c2849119e3d80d1f5b0f64ec5b70f4b">GPIO_FUN_ALT0</a>, <a class="el" href="gpio_8h.html#aaa7921da231fd2b96575fa522e2c1970">GPIO_PULL_UP</a>, and <a class="el" href="gpio_8h.html#a204d9425793768ccb782c84f0739a04b">gpio_set_pull()</a>.</p>

</div>
</div>
<a class="anchor" id="a5dc23eedff49dd1a087a73a8b662c3dc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> i2c_master_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kstdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Algorithm: Clear off previously set flags, set the DLEN and Address registers, Set the start bit to 1 and wait for the data to get populated in the FIFO (RXD). Check for the errors in acknowledgement while waiting. If an acknowledgement error is encountered, the read process is terminated and the value returned is 0. Once the data is availablein the FIFO register (RXD), read it byte by byte and copy it to the location pointed by 'buf'. </p>
<p>reads from I2C device</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*buf</td><td>Pointer to the memory location where the read values would be stored. </td></tr>
    <tr><td class="paramname">len</td><td>Length of data to be read. </td></tr>
    <tr><td class="paramname">addr</td><td>Address of I2C device. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0: Read Failure 1: Read Successful </dd></dl>

<p>Referenced by <a class="el" href="ads1015_8c.html#aae4bcfe4f7a97c36d689d5e28a3666b6">adc_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a133d4c889aaa1dbf4bede53f6a90f9d6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> i2c_master_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kstdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a>&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kstdint_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Algorithm: Clear off previously set flags, set the values of the DLEN and Address registers and set the start bit to 1. Wait for the transfer process to become active (TA). Once the transfer is active, check if the FIFO can accept data (TXD) and keep writing to the FIFO until the whole data has been written. If the FIFO gets filled, wait for it to be able to start accepting data again. If acknowledgement errors are encountered, the write process is terminated and 0 is returned. </p>
<p>writes to I2C device</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*buf</td><td>Pointer to the memory location from which the values would be written. </td></tr>
    <tr><td class="paramname">len</td><td>Length of data to be written. </td></tr>
    <tr><td class="paramname">addr</td><td>Address of I2C device. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0: Write Failure 1: Write Successful </dd></dl>

<p>Referenced by <a class="el" href="ads1015_8c.html#aae4bcfe4f7a97c36d689d5e28a3666b6">adc_read()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Dec 8 2016 19:14:12 for 18-349 Kernel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
